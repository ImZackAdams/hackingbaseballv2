<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="{{ url_for('static', filename='favicon.ico') }}"
      type="image/x-icon"
    />
    <title>Hacking Baseball</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="{{ url_for('static', filename='css/styles.css') }}"
      rel="stylesheet"
    />
    <script src="https://js.stripe.com/v3/"></script>
  </head>
  <body>
    <header class="header">
      <div>
        <img
          src="{{ url_for('static', filename='logo.png') }}"
          alt="Logo"
          class="logo_img"
        />
      </div>
      <div class="brand_name">Hacking Baseball</div>
    </header>

    <section class="games-container">
      <div class="hero_content">
        <p>
          With our AI/ML model tailored for baseball statistics, we can predict
          the outcome of games with remarkable accuracy. Whether you're a
          die-hard fan or just curious about the sport, our website provides
          insights that make it easy to know who's going to win each game.
        </p>
      </div>
      {% if games %}
      <div>
        <h2>Today's Games</h2>
        <form id="game-selection-form">
          <table class="table">
            <thead>
              <tr>
                <th>Game</th>
                <th>Date</th>
                <th>Select</th>
              </tr>
            </thead>
            <tbody>
              {% for game in games %}
              <tr>
                <td>{{ game.away_team }} at {{ game.home_team }}</td>
                <td>{{ game.formatted_date }}</td>
                <td class="text-end">
                  <input type="checkbox" name="game_id" value="{{ game.id }}" />
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <div class="text-end">
            <button type="submit" class="btn btn-lg custom-btn btn-block mb-3">
              Checkout
            </button>
          </div>
        </form>
      </div>
      {% else %}
      <div class="alert alert-info" role="alert">
        No games scheduled for today.
      </div>
      {% endif %}
    </section>

    

    <footer>
      <div class="container">
        <p>
          <a href="{{ url_for('terms_of_service') }}">Terms of Service</a>
        </p>
        <p>
          <a href="{{ url_for('privacy_policy') }}">Privacy Policy</a>
        </p>
        <p>
          <small
            >&copy; <span id="currentYear"></span> Hacking Baseball | All rights
            reserved</small
          >
        </p>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script>
      document.getElementById("currentYear").textContent =
        new Date().getFullYear();
    </script>
    <script>
      var stripe = Stripe(
        "pk_test_51PG1mPIiIqA6x4U9lNczLfuXAXj3xq1pL72t17AK0fD6ffaKgteH6GN7pdo9KLjZQSmdEhOxyJLY3SAUv0Rb034V00W5JxNclc"
      );
      document
        .getElementById("game-selection-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          const selectedGames = Array.from(
            document.querySelectorAll('input[name="game_id"]:checked')
          ).map(function (checkbox) {
            return checkbox.value;
          });
          console.log("Selected Games: ", selectedGames); // Debugging
          if (selectedGames.length > 0) {
            // Send the selected game IDs to the server
            fetch("/create-checkout-session", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ selectedGames: selectedGames }),
            })
              .then((response) => response.json())
              .then((data) => {
                console.log("Checkout Session Created:", data); // Debugging
                // Redirect to the Stripe Checkout page
                stripe.redirectToCheckout({ sessionId: data.sessionId });
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred. Please try again.");
              });
          } else {
            alert("Please select at least one game to proceed to checkout.");
          }
        });
    </script>
  </body>
</html>
